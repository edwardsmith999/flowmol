<HTML>
<HEAD>
   <TITLE> module coupler_internal_md (generated by f90doc) </TITLE>
</HEAD>
<H1> Module coupler_internal_md </H1>
<PRE>module coupler_internal_md

        ! Uses
    use <A HREF="coupler_parameters.html">coupler_parameters</A>

        ! Types
    public type <A HREF="coupler_internal_md.html#type_bbox_domain">bbox_domain</A>
    public type <A HREF="coupler_internal_md.html#type_cfd_box_sum">cfd_box_sum</A>

        ! Variables
    type (bbox_domain), public, target :: <A HREF="coupler_internal_md.html#var_bbox">bbox</A>
    real (kind=kind (0.d0)), public :: <A HREF="coupler_internal_md.html#var_dy_pure_md">DY_PURE_MD</A>
    real (kind=kind (0.d0)), public, dimension (3) :: <A HREF="coupler_internal_md.html#var_domain_lengths">domain_lengths</A>
    real (kind=kind (0.d0)), public, dimension (3) :: <A HREF="coupler_internal_md.html#var_half_domain_lengths">half_domain_lengths</A>
    type (cfd_grid_info), public :: <A HREF="coupler_internal_md.html#var_cfd_box">cfd_box</A>
    logical, public :: <A HREF="coupler_internal_md.html#var_dump_overlap_map">dump_overlap_map</A> = .true.
    real (kind=kind (0.d0)), public :: <A HREF="coupler_internal_md.html#var_fop_time_ratio">FoP_time_ratio</A> = 1.0
    real (kind=kind (0.d0)), public :: <A HREF="coupler_internal_md.html#var_fsig">fsig</A> = 1.0
    integer, public :: <A HREF="coupler_internal_md.html#var_md_steps_per_dt_cfd">md_steps_per_dt_cfd</A> = -1
    real (kind=kind (0.d0)), public, dimension(:,:,:,:,:), allocatable :: <A HREF="coupler_internal_md.html#var_vel_fromcfd">vel_fromCFD</A>
    integer, public :: <A HREF="coupler_internal_md.html#var_itm1">itm1</A>
    integer, public :: <A HREF="coupler_internal_md.html#var_itm2">itm2</A>
    integer, public :: <A HREF="coupler_internal_md.html#var_cfd_code_id">cfd_code_id</A> = couette_parallel

        ! Subroutines and functions
    public subroutine <A HREF="coupler_internal_md.html#subroutine_coupler_md_init">coupler_md_init</A> (nsteps, dt_md, icomm_grid, icoord, npxyz_md, globaldomain, density)
    public subroutine <A HREF="coupler_internal_md.html#subroutine_create_map_md">create_map_md</A> ()
    public function <A HREF="coupler_internal_md.html#function_globalise">globalise</A> (r) result (rg)
    public function <A HREF="coupler_internal_md.html#function_localise">localise</A> (r) result (rg)
    public function <A HREF="coupler_internal_md.html#function_map_md2cfd_global">map_md2cfd_global</A> (r) result (rg)
    public function <A HREF="coupler_internal_md.html#function_map_cfd2md_global">map_cfd2md_global</A> (r) result (rg)
    public subroutine <A HREF="coupler_internal_md.html#subroutine_write_overlap_map">write_overlap_map</A> ()

end module coupler_internal_md
</PRE>

<HR><H2> Description of Types </H2>
<A NAME="type_bbox_domain"><H3>bbox_domain</H3></A>
<PRE>public type bbox_domain
    integer :: is
    integer :: ie
    integer :: js
    integer :: je
    integer :: ks
    integer :: ke
    integer :: iso
    integer :: ieo
    integer :: jso
    integer :: jeo
    integer :: kso
    integer :: keo
    real (kind=kind (0.d0)), dimension (2,3) :: bb
end type bbox_domain
</PRE>
<A NAME="type_cfd_box_sum"><H3>cfd_box_sum</H3></A>
<PRE>public type cfd_box_sum
    integer :: np
    real (kind=kind (0.d0)), dimension (3) :: v
    real (kind=kind (0.d0)), dimension (3) :: a
end type cfd_box_sum
</PRE>

<HR><H2> Description of Variables </H2>
<A NAME="var_bbox"><H3>bbox</H3></A>
<PRE>type (bbox_domain), public, target :: bbox
</PRE>
<A NAME="var_dy_pure_md"><H3>DY_PURE_MD</H3></A>
<PRE>real (kind=kind (0.d0)), public :: DY_PURE_MD
</PRE>
<A NAME="var_domain_lengths"><H3>domain_lengths</H3></A>
<PRE>real (kind=kind (0.d0)), public, dimension (3) :: domain_lengths
</PRE>
<A NAME="var_half_domain_lengths"><H3>half_domain_lengths</H3></A>
<PRE>real (kind=kind (0.d0)), public, dimension (3) :: half_domain_lengths
</PRE>
<A NAME="var_cfd_box"><H3>cfd_box</H3></A>
<PRE>type (cfd_grid_info), public :: cfd_box
</PRE>
<A NAME="var_dump_overlap_map"><H3>dump_overlap_map</H3></A>
<PRE>logical, public :: dump_overlap_map = .true.
</PRE>
<A NAME="var_fop_time_ratio"><H3>FoP_time_ratio</H3></A>
<PRE>real (kind=kind (0.d0)), public :: FoP_time_ratio = 1.0
</PRE>
<A NAME="var_fsig"><H3>fsig</H3></A>
<PRE>real (kind=kind (0.d0)), public :: fsig = 1.0
</PRE>
<A NAME="var_md_steps_per_dt_cfd"><H3>md_steps_per_dt_cfd</H3></A>
<PRE>integer, public :: md_steps_per_dt_cfd = -1
</PRE>
<A NAME="var_vel_fromcfd"><H3>vel_fromCFD</H3></A>
<PRE>real (kind=kind (0.d0)), public, dimension(:,:,:,:,:), allocatable :: vel_fromCFD
</PRE>
<A NAME="var_itm1"><H3>itm1</H3></A>
<PRE>integer, public :: itm1
</PRE>
<A NAME="var_itm2"><H3>itm2</H3></A>
<PRE>integer, public :: itm2
</PRE>
<A NAME="var_cfd_code_id"><H3>cfd_code_id</H3></A>
<PRE>integer, public :: cfd_code_id = couette_parallel
</PRE>

<HR><H2> Description of Subroutines and Functions </H2>
<A NAME="subroutine_coupler_md_init"><H3>coupler_md_init</H3></A>
<PRE>public subroutine coupler_md_init (nsteps, dt_md, icomm_grid, icoord, npxyz_md, globaldomain, density)
    integer, intent(in) :: nsteps
    real (kind=kind (0.d0)), intent(in) :: dt_md
    integer, intent(in) :: icomm_grid
    integer, dimension(:,:), allocatable, intent(in) :: icoord
    integer, dimension(3), intent(in) :: npxyz_md
    real (kind=kind (0.d0)), dimension(3), intent(in) :: globaldomain
    real (kind=kind (0.d0)), intent(in) :: density
    ! Calls: CPL_rank_map, MPI_Abort, MPI_Cart_rank, MPI_bcast, MPI_comm_dup, MPI_comm_rank, write_matrix_int
end subroutine coupler_md_init
</PRE>
 Initialisation routine for coupler module - Every variable is sent and stored
 to ensure both md and cfd region have an identical list of parameters
<P>
 <UL>
 <LI>  Synopsis
<P>
  <UL>
  <LI>  coupler_mf_init(nsteps,dt_md,icomm_grid,icoord,npxyz_md,globaldomain,density)
<P>
  </UL>
 <LI>  Input
<P>
  <UL>
  <LI>  nsteps
   <UL>
   <LI>  Number of time steps the MD code is expected to run for (integer)
   </UL>
  <LI>  dt_md
   <UL>
   <LI>  MD timestep (dp real)
   </UL>
  <LI>  icomm_grid
   <UL>
   <LI>  The MPI communicator setup by the MPI_CART_CREATE command in the 
     CFD region (integer)
   </UL>
  <LI>  icoord
   <UL>
   <LI>  The three coordinate for each rank in the domain (integer array nproc by 3)
   </UL>
  <LI>  npxyz_md
   <UL>
   <LI>  Number of processors in each cartesian dimension (integer array 3)
   </UL>
  <LI>  globaldomain
   <UL>
   <LI>  Size of domain in each cartesian dimension (dp real array 3)
   </UL>
  <LI>  density
   <UL>
   <LI>  Density of the CFD simulation (dp_real)
<P>
   </UL>
  </UL>
 <LI>  Input/Output
  <UL>
  <LI>  NONE
<P>
  </UL>
 <LI>  Output
  <UL>
  <LI>  NONE
<P>
  </UL>
 </UL>
<P>
<STRONG>Author:</STRONG> Edward Smith
<A NAME="subroutine_create_map_md"><H3>create_map_md</H3></A>
<PRE>public subroutine create_map_md ()
    ! Calls: MPI_barrier, make_bbox, mpi_allgather, mpi_irecv, mpi_waitall, write_overlap_map
end subroutine create_map_md
</PRE>
<A NAME="function_globalise"><H3>globalise</H3></A>
<PRE>public function globalise (r) result (rg)
    real (kind=kind (0.d0)), intent(in), dimension (3) :: r
    real (kind=kind (0.d0)), dimension (3) :: rg
end function globalise
</PRE>
<A NAME="function_localise"><H3>localise</H3></A>
<PRE>public function localise (r) result (rg)
    real (kind=kind (0.d0)), intent(in), dimension (3) :: r
    real (kind=kind (0.d0)), dimension (3) :: rg
end function localise
</PRE>
<A NAME="function_map_md2cfd_global"><H3>map_md2cfd_global</H3></A>
<PRE>public function map_md2cfd_global (r) result (rg)
    real (kind=kind (0.d0)), intent(in), dimension (3) :: r
    real (kind=kind (0.d0)), dimension (3) :: rg
end function map_md2cfd_global
</PRE>
<A NAME="function_map_cfd2md_global"><H3>map_cfd2md_global</H3></A>
<PRE>public function map_cfd2md_global (r) result (rg)
    real (kind=kind (0.d0)), intent(in), dimension (3) :: r
    real (kind=kind (0.d0)), dimension (3) :: rg
end function map_cfd2md_global
</PRE>
<A NAME="subroutine_write_overlap_map"><H3>write_overlap_map</H3></A>
<PRE>public subroutine write_overlap_map ()
    ! Calls: mpi_barrier, mpi_file_close, mpi_file_open, mpi_file_set_size, mpi_file_write_shared
end subroutine write_overlap_map
</PRE>
</HTML>
